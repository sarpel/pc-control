openapi: 3.0.3
info:
  title: Voice-Controlled PC Assistant REST API
  description: REST API for device pairing, setup, and management operations
  version: 1.0.0
  contact:
    name: PC Control Voice Assistant Team
  license:
    name: MIT

servers:
  - url: http://localhost:8765/api/v1
    description: Development server
  - url: https://pc.local:8765/api/v1
    description: Production server with mTLS

paths:
  /health:
    get:
      summary: Health check endpoint
      description: Returns server health status and readiness
      tags:
        - System
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: ["healthy", "degraded", "unhealthy"]
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                  uptime_seconds:
                    type: integer
                  services:
                    type: object
                    properties:
                      audio_processor:
                        type: string
                        enum: ["running", "stopped", "error"]
                      stt_service:
                        type: string
                        enum: ["running", "stopped", "error"]
                      llm_service:
                        type: string
                        enum: ["running", "stopped", "error"]
                      mcp_servers:
                        type: string
                        enum: ["running", "stopped", "error"]

  /pairing/initiate:
    post:
      summary: Initiate device pairing
      description: Start the pairing process for a new Android device
      tags:
        - Pairing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - android_device_id
                - android_fingerprint
                - device_name
              properties:
                android_device_id:
                  type: string
                  description: Unique Android device identifier
                  example: "android_device_12345"
                android_fingerprint:
                  type: string
                  description: Android device certificate fingerprint (SHA-256)
                  example: "a1:b2:c3:d4:e5:f6:aa:bb:cc:dd:ee:ff:11:22:33:44:55:66:77:88:99:00:aa:bb:cc:dd:ee:ff:00:11:22:33"
                device_name:
                  type: string
                  description: Human-readable device name
                  example: "Samsung Galaxy S21"
                pc_info:
                  type: object
                  properties:
                    name:
                      type: string
                      example: "Ev PC"
                    ip_address:
                      type: string
                      format: ipv4
                      example: "192.168.1.100"
                    mac_address:
                      type: string
                      format: mac
                      example: "00:11:22:33:44:55"
      responses:
        '201':
          description: Pairing initiated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  pairing_id:
                    type: string
                    format: uuid
                    description: Unique pairing session identifier
                  pairing_code:
                    type: string
                    pattern: '^[0-9]{6}$'
                    description: 6-digit pairing code
                  expires_at:
                    type: string
                    format: date-time
                    description: Pairing session expiration time
                  status:
                    type: string
                    enum: ["initiated"]
                    example: "initiated"
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Device already paired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pairing/confirm/{pairing_id}:
    post:
      summary: Confirm device pairing
      description: Complete the pairing process with pairing code and PC certificate
      tags:
        - Pairing
      parameters:
        - name: pairing_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Pairing session identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - pairing_code
                - pc_fingerprint
                - pc_info
              properties:
                pairing_code:
                  type: string
                  pattern: '^[0-9]{6}$'
                  description: 6-digit pairing code shown on PC
                  example: "123456"
                pc_fingerprint:
                  type: string
                  description: PC certificate fingerprint (SHA-256)
                  example: "ff:ee:dd:cc:bb:aa:99:88:77:66:55:44:33:22:11:00:aa:bb:cc:dd:ee:ff:33:22:11:00:aa:bb:cc:dd:ee:ff"
                pc_info:
                  type: object
                  required:
                    - name
                    - ip_address
                    - mac_address
                  properties:
                    name:
                      type: string
                      example: "Ev PC"
                    ip_address:
                      type: string
                      format: ipv4
                      example: "192.168.1.100"
                    mac_address:
                      type: string
                      format: mac
                      example: "00:11:22:33:44:55"
      responses:
        '200':
          description: Pairing completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  pairing_id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: ["completed"]
                    example: "completed"
                  authentication_token:
                    type: string
                    description: JWT token for WebSocket authentication
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  expires_at:
                    type: string
                    format: date-time
                    description: Token expiration time (24 hours)
        '400':
          description: Invalid pairing code or session expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Pairing session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '410':
          description: Pairing session expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pairing/status/{pairing_id}:
    get:
      summary: Check pairing status
      description: Get current status of a pairing session
      tags:
        - Pairing
      parameters:
        - name: pairing_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Pairing status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  pairing_id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: ["initiated", "awaiting_confirmation", "completed", "failed", "expired"]
                  created_at:
                    type: string
                    format: date-time
                  expires_at:
                    type: string
                    format: date-time
                  completed_at:
                    type: string
                    format: date-time
                    nullable: true
        '404':
          description: Pairing session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /devices:
    get:
      summary: List paired devices
      description: Get list of all paired Android devices
      tags:
        - Devices
      responses:
        '200':
          description: List of paired devices
          content:
            application/json:
              schema:
                type: object
                properties:
                  devices:
                    type: array
                    items:
                      $ref: '#/components/schemas/PairedDevice'

  /devices/{device_id}:
    delete:
      summary: Remove paired device
      description: Remove a device from the paired devices list
      tags:
        - Devices
      parameters:
        - name: device_id
          in: path
          required: true
          schema:
            type: string
          description: Android device identifier
      responses:
        '204':
          description: Device removed successfully
        '404':
          description: Device not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /wake:
    post:
      summary: Send Wake-on-LAN packet
      description: Wake up a PC using WoL magic packet
      tags:
        - System
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mac_address
                - ip_address
              properties:
                mac_address:
                  type: string
                  format: mac
                  description: Target PC MAC address
                  example: "00:11:22:33:44:55"
                ip_address:
                  type: string
                  format: ipv4
                  description: Broadcast IP address or specific PC IP
                  example: "192.168.1.255"
                port:
                  type: integer
                  default: 9
                  description: WoL port number
                  example: 9
                device_id:
                  type: string
                  description: Optional device identifier for authorization
      responses:
        '200':
          description: WoL packet sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: ["sent", "failed", "already_awake"]
                    example: "sent"
                  message:
                    type: string
                    description: Status message in Turkish
                    example: "PC'niz uyandırılıyor..."
                  target_ip:
                    type: string
                    example: "192.168.1.100"
                  target_mac:
                    type: string
                    example: "00:11:22:33:44:55"
        '400':
          description: Invalid MAC address or IP address
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Device not authorized for this PC
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /system/info:
    get:
      summary: Get PC system information
      description: Retrieve current PC system status and information
      tags:
        - System
      responses:
        '200':
          description: System information retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemInfo'

  /system/commands:
    get:
      summary: Get command history
      description: Retrieve recent command execution history
      tags:
        - System
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          description: Maximum number of commands to return
        - name: device_id
          in: query
          schema:
            type: string
          description: Filter by specific device
      responses:
        '200':
          description: Command history retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  commands:
                    type: array
                    items:
                      $ref: '#/components/schemas/CommandHistory'
                  total_count:
                    type: integer

  /certificates:
    post:
      summary: Generate new certificates
      description: Generate new mTLS certificates for the PC server
      tags:
        - Security
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pc_name:
                  type: string
                  description: PC name for certificate
                  example: "Ev PC"
                validity_days:
                  type: integer
                  default: 365
                  description: Certificate validity period in days
                  minimum: 1
                  maximum: 3650
      responses:
        '201':
          description: Certificates generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  certificate_fingerprint:
                    type: string
                    description: SHA-256 fingerprint of the generated certificate
                  certificate_path:
                    type: string
                    description: Path to generated certificate file
                  private_key_path:
                    type: string
                    description: Path to generated private key file
                  expires_at:
                    type: string
                    format: date-time
                    description: Certificate expiration date

components:
  schemas:
    Error:
      type: object
      required:
        - error_code
        - error_message
        - timestamp
      properties:
        error_code:
          type: string
          enum: [
            "invalid_request", "authentication_failed", "device_not_found",
            "pairing_failed", "pairing_expired", "device_already_paired",
            "invalid_fingerprint", "wol_failed", "permission_denied",
            "rate_limit_exceeded", "server_error"
          ]
        error_message:
          type: string
          description: User-friendly error message in Turkish
        details:
          type: object
          description: Additional error details for debugging
        timestamp:
          type: string
          format: date-time
        request_id:
          type: string
          description: Request identifier for troubleshooting

    PairedDevice:
      type: object
      properties:
        device_id:
          type: string
          description: Unique Android device identifier
        device_name:
          type: string
          description: Human-readable device name
        android_fingerprint:
          type: string
          description: Android device certificate fingerprint
        paired_at:
          type: string
          format: date-time
          description: When the device was paired
        last_connected:
          type: string
          format: date-time
          description: Last connection timestamp
        is_active:
          type: boolean
          description: Whether device is currently connected
        connection_info:
          type: object
          properties:
            ip_address:
              type: string
            last_heartbeat:
              type: string
              format: date-time
            latency_ms:
              type: integer

    SystemInfo:
      type: object
      properties:
        pc_name:
          type: string
          example: "Ev PC"
        os_version:
          type: string
          example: "Windows 11 Pro"
        architecture:
          type: string
          example: "x64"
        cpu_info:
          type: object
          properties:
            model:
              type: string
              example: "Intel Core i7-10700K"
            cores:
              type: integer
              example: 8
            threads:
              type: integer
              example: 16
            usage_percentage:
              type: number
              example: 15.5
        memory_info:
          type: object
          properties:
            total_gb:
              type: number
              example: 32.0
            used_gb:
              type: number
              example: 18.5
            available_gb:
              type: number
              example: 13.5
            usage_percentage:
              type: number
              example: 57.8
        disk_info:
          type: array
          items:
            type: object
            properties:
              drive_letter:
                type: string
                example: "C:"
              total_gb:
                type: number
                example: 512.0
              used_gb:
                type: number
                example: 256.5
              available_gb:
                type: number
                example: 255.5
              usage_percentage:
                type: number
                example: 50.1
        network_info:
          type: object
          properties:
            interfaces:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    example: "Ethernet"
                  ip_addresses:
                    type: array
                    items:
                      type: string
                    example: ["192.168.1.100"]
                  mac_address:
                    type: string
                    example: "00:11:22:33:44:55"
                  is_connected:
                    type: boolean
                    example: true
        service_status:
          type: object
          properties:
            voice_assistant_service:
              type: string
              enum: ["running", "stopped", "error"]
              example: "running"
            audio_processor:
              type: string
              enum: ["running", "stopped", "error"]
              example: "running"
            stt_service:
              type: string
              enum: ["running", "stopped", "error"]
              example: "running"
            llm_service:
              type: string
              enum: ["running", "stopped", "error"]
              example: "running"

    CommandHistory:
      type: object
      properties:
        command_id:
          type: string
          format: uuid
        transcription:
          type: string
          example: "Chrome'u aç"
        device_id:
          type: string
        status:
          type: string
          enum: ["completed", "failed", "cancelled"]
        actions_count:
          type: integer
        successful_actions:
          type: integer
        execution_time_ms:
          type: integer
        timestamp:
          type: string
          format: date-time
        error_message:
          type: string
          nullable: true

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained during device pairing

security:
  - BearerAuth: []

tags:
  - name: System
    description: System information and management
  - name: Pairing
    description: Device pairing and authentication
  - name: Devices
    description: Paired device management
  - name: Security
    description: Certificate management